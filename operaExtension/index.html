<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Ek$igator</title>
	<meta charset="UTF-8">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
	<script>
        $(document).ready( function() {
			var theButton;
			var ToolbarUIItemProperties = {
					disabled: false,
					title: 'Ek$igator',
					icon: 'icons/logo_32.png',
					popup: {
						href: 'popup.html',
						width: 200,
						height: 400
					},
					badge: {
            			display: "none",
            			textContent: "",
            			color: "white",
						backgroundColor: "rgba(211, 0, 4, 1)"
         			 }

				}
			theButton = opera.contexts.toolbar.createItem(ToolbarUIItemProperties);
			opera.contexts.toolbar.addItem(theButton);

            
            var userName = "yuxel@foobar";
            var userApiKey = "foobar";

            var apiURL = "http://api.eksigator.com/";
            var login = apiURL + userName + "/" + userApiKey + "/";


            var populateBadge = function(){
                var count = 0;
                $.getJSON(login + "getList?jsoncallback=?", function(data) {
                    $.each(data, function(i, item) {
                        if(item.status == 1) {
                            count++;
                        }
                    });

                    if(count > 0){
                        theButton.badge.display = "block";
                        theButton.badge.textContent = count;
                    }
                    else {
                        theButton.badge.display = "none";
                    }
                });
            };

            setInterval(function() {
                populateBadge(); 
            }, 5000);

		});
	</script>
</head>
<body>

</body>
</html>
